{% extends 'tracker/base.html' %}
{% load static %}
{% block content %}
<!-- Background Shapes Container -->
<div class="background-shapes">
    <div class="shape yellow-square"></div>
    <div class="shape red-circle"></div>
    <div class="shape blue-semicircle-left"></div>
  </div>
  
<div class="container_2">
<h2 style="font-family: 'Urbanist', sans-serif; font-size: 24px; font-weight: bold;"> Dashboard</h2>

{% if request.user.is_authenticated %}
<h2 style="font-family: 'Urbanist', sans-serif; font-size: 24px;">Hello, {{ request.user.username }}!</h2>
{% endif %}
</div>


<div class="container_3">
<div>
<button type="button" class="btn_first" data-bs-toggle="modal" data-bs-target="#addEntryModal"> + Add Entry for {{ month }}/{{ year }} </button>
<!-- Include Add Entry Modal -->
{% include 'tracker/modals/add_entry_modal.html' %}
<button type="button" class="btn_first2" style="margin-bottom: 20px; font-family: 'Urbanist', sans-serif;" data-bs-toggle="modal" data-bs-target="#setBudgetModal"> Set Budget </button>

</div>


{% include 'tracker/modals/set_budget_modal.html'%}
<!-- Include Filter Form -->
{% include 'tracker/includes/filters.html' %}
</div>

<!-- warning -->
{% if exceeded_categories %}
    {% include 'tracker/includes/warning.html'%}
{% endif %}

<!-- Include Summary -->
{% include 'tracker/includes/summary.html' %}

<!-- Include Charts -->
{% include 'tracker/includes/charts.html' %}
<div class="container_4" >
    <div class="table_title">
<!-- Fixed the table title -->
<h2 style="font-family: 'Urbanist',sans-serif; font-size: 20px; justify-content: center; margin-bottom: 0;
"  >Entries for {{ month_name }} {{ year }}</h2>
<!-- Export Button -->
<a class="export" href="{% url 'export_csv' %}" style="
    display: inline-block;
    padding: 10px 20px;
    background-color: #FEBD01;
    color: rgb(0, 0, 0);
    font-size: 14px;
    font-family: 'Urbanist', sans-serif;
    text-decoration: none; /* Removes underline */
    border: none;
    border-radius: 100px;
    transition: background-color 0.3s ease, transform 0.2s ease;
    cursor: pointer;">
    Export as CSV
</a>


</div>

<table class="entries-table" cellpadding="5">
    <tr>
        <th>Date</th>
        <th>Title</th>
        <th>Type</th>
        <th>Category</th>
        <th>Amount</th>
        <th>Notes</th>
        <th>Actions</th> <!-- Added header for Edit/Delete buttons -->
    </tr>
    {% for entry in entries %}
    <tr>
        <td style="font-weight: bold;">{{ entry.date }}</td>
        <td><a style="text-decoration:inherit; color:#000000;"  href="{% url 'edit_entry' entry.id %}">{{ entry.title }}</a></td>
        <td>
            <span class="{% if entry.entry_type == 'Income' %}income-badge{% else %}expense-badge{% endif %}">
              {{ entry.entry_type }}
            </span>
          </td>
                  <td>{{ entry.category.name }}</td>
        <td style="font-weight: bold;">â‚±{{ entry.amount }}</td>
        <td style="font-style: italic;"> {{ entry.notes }} </td>
        <td>
            <button
            type="button"
            style="border: 0px; background-color: transparent; padding: 5px;"
            onmouseover="this.children[0].style.transform='scale(1.2)'"
            onmouseout="this.children[0].style.transform='scale(1)'"
            data-bs-toggle="modal"
            data-bs-target="#editEntryModal{{ entry.id }}"
            data-bs-toggle="tooltip"  
            title="Edit Entry"  
          >
            <img src="{% static 'tracker/images/edit (2).png' %}" alt="Edit" style="width: 24px; height: 24px;" />
          </button>
          

          <button
  type="button"
  style="border: 0px; background-color: transparent; padding: 5px;"
  onmouseover="this.children[0].style.transform='scale(1.2)'"
  onmouseout="this.children[0].style.transform='scale(1)'"
  data-bs-toggle="modal"
  data-bs-target="#deleteEntryModal{{ entry.id }}"
  data-bs-toggle="tooltip"  
  title="Delete Entry" 
>
  <img src="{% static 'tracker/images/delete (2).png' %}" alt="Delete" style="width: 24px; height: 24px;" />
</button>


        </td>
    </tr>
    
    {% empty %}
    <tr>
        <td colspan="6">No entries this month.</td> <!-- Fixed colspan to 6 -->
    </tr>

    {% endfor %}
</table>


</div>
<!-- Entry Modals (placed outside of the table) -->
{% for entry in entries %}
  {% include 'tracker/modals/edit_entry_modal.html' %}
  {% include 'tracker/modals/delete_entry_modal.html' %}
{% endfor %}



<!-- Pass data to JavaScript -->
{{ category_names|json_script:"category_names" }}
{{ category_totals|json_script:"category_totals" }}
{{ income|json_script:"income" }}
{{ expense|json_script:"expense" }}
{{ income_category_names|json_script:"income_category_names" }}
{{ income_category_totals|json_script:"income_category_totals" }}

<!-- Load libraries -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Load your custom charts.js file with versioning -->
<script src="{% static 'tracker/js/charts.js' %}?v=1.1"></script>

{% endblock %}

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });
  });
</script>

  